<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.pc.driver.dao.DriverDao">

    <!--统计用户账号数量-->
    <select id="countDriverAccount" parameterType="com.xzsd.pc.driver.entity.DriverData" >
        select count(driver_account)
        from driver
        where is_delete = 0
        and driver_account = #{driverAccount}
    </select>

    <!--新增用户-->
    <insert id="driverAdd" parameterType="com.xzsd.pc.driver.entity.DriverData">
        insert into driver
        (
         driver_id,
         driver_name,
         driver_account,
         driver_password,
         identity,
         driver_phone,
         province_id,
         city_id,
         area_id,



         is_delete,
         create_time,
         create_by,
         update_time,
         update_by,
         version
         )
        values
           (
           #{driverId},
            #{driverName},
            #{driverAccount},
            #{driverPassword},
            #{identity},
            #{phone},
           #{provinceId},
           #{cityId},
           #{areaId},




            #{isDelete},
            now(),
            #{createBy},
            now(),
            #{updateBy},
            0)
    </insert>



    <!--司机列表-->
    <select id="driverListCheck" parameterType="com.xzsd.pc.driver.entity.DriverData" resultType="com.xzsd.pc.driver.entity.DriverData">
        select
        a.driver_id driverId,
        a.driver_name driverName,
        a.driver_account driverAccount,
        a.identity identity,
        a.driver_phone phone,
        a.version
        from  driver a
        where a.is_delete = 0
        <if test="driverAccount != null and driverAccount != ''">
            and a.driver_account like concat('%', #{driverAccount}, '%')
        </if>
        <if test="driverName != null and driverName != ''">
            and a.driver_name like concat('%', #{driverName}, '%')
        </if>
        order by create_time desc
    </select>

    <!--删除用户-->
    <update id="driverDelete" parameterType="com.xzsd.pc.driver.entity.DriverData">
        update driver
        set
        is_delete = 1,
        create_time= now(),
        update_by = #{userCode},
        version = version + 1
        where driver_id in
        <foreach item="driverId" index="index" collection="listId" open="(" separator="," close=")">
            #{userId}
        </foreach>
    </update>




    <!--修改用户信息-->
    <update id="driverUpdate" parameterType="com.xzsd.pc.driver.entity.DriverData">
        update driver
        set
            driver_Id    =   #{driverId},
            driver_name    = #{driverName},
            driver_account    = #{driverAccount},
            identity      = #{identity},
           driver_phone        = #{phone},
            driver_password   =  #{driverPassword},


            province_id  = #{provinceId},
             city_id  = #{cityId},
             area_id  = #{areaId},

            version      = version + 1
        where driver_Id = #{driverId}
          and version = #{version}
    </update>

    <!--用户详情信息-->
    <select id="getDriverByDriverId" parameterType="java.lang.String" resultType="com.xzsd.pc.driver.entity.DriverData">
        select
            driver_Id driverId,

            driver_name driverName,
            driver_account driverAccount,
            driver_password driverPassword,
            identity identity,
           driver_phone phone,

            version
        from driver
        where driver_Id = #{driverId}
        and is_delete = 0
    </select>



</mapper>