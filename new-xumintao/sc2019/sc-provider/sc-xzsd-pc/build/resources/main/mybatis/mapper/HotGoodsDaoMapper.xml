<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.pc.hotGoods.dao.HotGoodsDao">
    <!--统计热门商品id数量-->
    <select id="countHotGoodsId" parameterType="com.xzsd.pc.hotGoods.entity.HotGoodsData" resultType="int">
        select count(hot_goods_id)
        from hotGoods
        where is_delete = 0
        and hot_goods_id = #{hotGoodsId}
    </select>

    <!--热门商品新增-->
    <insert id="hotGoodsAdd" parameterType="com.xzsd.pc.hotGoods.entity.HotGoodsData">
    insert into hotGoods
    (
     hot_goods_id,
     goods_id,
     sort,
     is_delete,
     create_by,
     create_time,
     update_by,
     update_time,
     version
     )
     values
     (
     #{hotGoodsId},
     #{goodsId},
     #{sort},
     #{isDelete},
     #{createBy},
     #{createTime},
     #{updateBy},
     #{updateTime},
     0
     )

</insert>

    <!--热门商品分页查询-->
    <select id="hotGoodsListCheck" parameterType="com.xzsd.pc.hotGoods.entity.HotGoodsData" resultType="com.xzsd.pc.hotGoods.entity.HotGoodsData">
        select
        a.sort sort,
        b.goods_id goodsId,
        b.goods_name goodsName,
        b.goods_price goodsPrice,
        b.goods_introduction goodsIntroduction,
        a.hot_goods_id hotGoodsId,
        a.version
        from  hotGoods a left join
        goods b on
        a.goods_id = b.goods_id

    </select>

    <!--热门商品删除-->
    <update id="hotGoodsDelete" parameterType="com.xzsd.pc.hotGoods.entity.HotGoodsData">
        update hotGoods
        set
        is_delete = 1 ,
        update_time = now(),
        version = version + 1
        where is_delete = 0 and hot_goods_id in
        <foreach item="hotGoodsId" index="index" collection="listId" open="(" separator="," close=")">
            #{hotGoodsId}
        </foreach>

    </update>

    <!--热门商品修改-->
    <update id="hotGoodsUpdate" parameterType="com.xzsd.pc.hotGoods.entity.HotGoodsData">
     update hotGoods
        set
        goods_id = #{goodsId},
        update_by = #{updateBy},
         update_time = now(),
        version = version + 1
        where is_delete = 0
        and hot_goods_id = #{hotGoodsId} and version = #{version}
    </update>

    <!--    查询热门商品详情-->
    <select id="getHotGoodsByHotGoodsId" parameterType="java.lang.String" resultType="com.xzsd.pc.hotGoods.entity.HotGoodsData">
    select
        a.hot_goods_id hotGoodsId,
        a.sort,
        b.goods_id goodsId,
        b.goods_name goodsName
        from hotGoods a
        left join goods b
        on (a.goods_id = b.goods_id)
        where a.is_delete = 0
        and a.hot_goods_id = #{hotGoodsId}

    </select>
</mapper>