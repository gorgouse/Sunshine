<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.pc.store算成功.dao.StoreDao">
<!--统计邀请码数量-->
    <select id="countInviteCode" parameterType="com.xzsd.pc.store算成功.entity.StoreData" resultType="int">
        select count(invite_code)
        from
        store
        where
        is_delete = 0
        and
        invite_code = #{inviteCode}

    </select>

    <!--统计营业执照编号数量-->
    <select id="countBussinessLicenseCode" parameterType="com.xzsd.pc.store算成功.entity.StoreData" resultType="int">
        select count(bussiness_license_code)
        from
        store
        where
        is_delete = 0
        and
        bussiness_license_code = #{bussinessLicenseCode}
    </select>

    <!--统计店长编号数量-->
    <select id="countStoreManagerId" parameterType="com.xzsd.pc.store算成功.entity.StoreData" resultType="int">
       select count(store_manager_id)
        from
        store
        where
        is_delete = 0
        and
        store_manager_id = #{storeManagerId}
    </select>


    <!--门店新增-->
    <insert id="storeAdd" parameterType="com.xzsd.pc.store算成功.entity.StoreData">
        insert into store
        (store_id,store_name,invite_code)
        values
        (#{storeId},#{storeName},#{inviteCode})
    </insert>

    <!--修改门店信息 -->
    <update id="storeUpdate" parameterType="com.xzsd.pc.store算成功.entity.StoreData" >
        update store set
        store_name = #{storeName}
    </update>



    <!--删除门店-->
    <update id="storeDelete" parameterType="com.xzsd.pc.store算成功.entity.StoreData">
        update store
        set
        is_delete = 1,
        update_by = #{userId},
        update_time = now(),
        version = version +1
        where store_id in
        <foreach item="storeId" index="index" collection="listId" open="(" separator="," close=")">
            #{storeId}
        </foreach>

    </update>

    <!--查询门店详情信息-->
    <select id="getStoreByStoreId" parameterType="java.lang.String" resultType="com.xzsd.pc.store算成功.entity.StoreData">
        select
        t1.store_id storeId,
        t1.store_name storeName,
        t1.phone phone,
        t1.user_id userId,
        t1.bussiness_license_code bussinessLicenseCode,
        t2.area_name provinceName,
        t3.area_name cityName,
        t4.area_name areaName,
        t1.address address,
        t1.version version
        from store t1, t_area t2, t_area t3, t_area t4
        where t1.store_id = #{storeId}
        and t2.id = t1.province_code
        and t3.id = t1.city_code
        and t4.id = t1.area_code
    </select>

    <!--店长查询自己门店信息  失败-->
    <select id="getListStore" parameterType="com.xzsd.pc.store算成功.entity.StoreData"
            resultType="com.xzsd.pc.store算成功.entity.StoreData">
        select
        t2.store_id storeId,
        t2.store_name storeName,
        t2.phone phone,
        t2.address address,
        t1.user_name userName,
        t2.invite_code inviteCode,
        t1.user_account storeManagerAccount,
        t2.version version
        from `user` t1, store t2
        where t1.user_id = t2.shop_manager_id
        and t1.user_id = #{userId}
        and t1.is_delete = 0
        and t2.is_delete = 0
        <if test="storeId != null and storeId != ''">
            and t2.id like concat('%', #{storeId}, '%')
        </if>
        <if test="storeName != null and storeName != ''">
            and t2.store_name like concat('%', #{storeName}, '%')
        </if>
        <if test="userName != null and userName != ''">
            and t1.user_name like concat('%', #{userName}, '%')
        </if>
        <if test="provinceCode != null and provinceCode != ''">
            and t2.province_code = #{provinceCode}
        </if>
        <if test="cityCode != null and cityCode!= ''">
            and t2.city_code = #{cityCode}
        </if>
        <if test="areaCode != null and areaCode != ''">
            and t2.area_code = #{areaCode}
        </if>
        order by t2.create_time desc
    </select>

    <!--管理员查询所有门店信息-->
    <select id="getListStoreByAdmin" parameterType="com.xzsd.pc.store算成功.entity.StoreData"
            resultType="com.xzsd.pc.store算成功.entity.StoreData">
        select
        t2.store_id storeId,
        t2.store_name storeName,
        t2.phone phone,
        t2.address address,
        t1.user_name userName,
        t2.invite_code inviteCode,
        t1.user_account userAccount,
        t2.version version
        from `user` t1, store t2
        where t1.user_id = t2.store_manager_id
        and t1.is_delete = 0
        and t2.is_delete = 0
        <if test="storeId != null and storeId != ''">
            and t2.id like concat('%', #{storeId}, '%')
        </if>
        <if test="storeName != null and storeName != ''">
            and t2.store_name like concat('%', #{storeName}, '%')
        </if>
        <if test="userName != null and userName != ''">
            and t1.user_name like concat('%', #{userName}, '%')
        </if>
        <if test="provinceCode != null and provinceCode != ''">
            and t2.province_code = #{provinceCode}
        </if>
        <if test="cityCode != null and cityCode!= ''">
            and t2.city_code = #{cityCode}
        </if>
        <if test="areaCode != null and areaCode != ''">
            and t2.area_code = #{areaCode}
        </if>
        order by t2.create_time desc
    </select>



</mapper>